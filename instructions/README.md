# Как помочь с русификатором

- [Как я могу помочь](#как-я-могу-помочь)
- [Что нужно сейчас?](#что-нужно-сейчас)
- [Как поправить перевод](#как-поправить-перевод)
- [Как самостоятельно запаковать](#как-самостоятельно-запаковать)
- [Как распаковать пак из игры](#как-распаковать-пак-из-игры)

## Как я могу помочь?

1. Если нашли ошибку, но не можете поправить сами - присылайте скриншот в [дискорд](https://discord.com/channels/1319370292316864563/1321913367442755735)
2. Если хотите поучаствовать в русификации, ниже есть инструкции

## Что нужно сейчас?

Есть совсем (или почти совсем) не переведенные файлы, можно начать с них:
1. mapdata/
2. ai.txt

Также можно править уже переведенный текст, если он переведен неправильно/не влезает в интерфейс/etc.

Для закаленных в боях бойцов есть файл Game.csv, с ним сложнее, так как файл большой 
<br>и там мало контекста - в идеале искать текст в нем точечно, опираясь на игру.

## Как поправить перевод

Текста на перевод лежат в двух местах: 

1. [FormatString](../patch/Ru_Patch_Strings_Main_P/ZhuxianClient/gamedata/client/FormatString)
2. [Game.csv](../patch/Locres/Game.csv)


### FormatString

Данные представлены в формате "ключ = значение". 
<br>Этот формат важно сохранять, игра будет искать перевод по ключу.

Полезное для форматирования:
- \n - перенос на новую строку
- \t - табуляция
- // - комментарий

Оригинальные китайские языковые файлы находятся [original](../original)

### Game.csv

Это распакованный .locres файл.
В таблице есть три столбца:
- key - ключ по которому игра ищет перевод
- source - оригинальный перевод (китайский)
- target - наш перевод (русский)

Перевод кладем строго в поле target - остальные НЕ трогаем!

### После правки перевода

Есть несколько вариантов:
1. Откройте Pull Request с изменениями (предпочтительный)
2. Пришлите скорректированный файл в [дискорд канал русификатора](https://discord.com/channels/1319370292316864563/1371067234818199622)

## Как самостоятельно запаковать

### Запаковка Game.csv в Game.locres

Если вы делали перевод в csv файле, необходимо запаковать его в .locres. 
<br>Для этого нам понадобится [UnrealLocres](https://github.com/akintos/UnrealLocres):
```bash
.\UnrealLocres.exe import D:\{путь до проекта}\wojd-ru\patch\Locres\OriginalGame.locres D:\{путь до проекта}\wojd-ru\patch\Locres\Game.csv -f csv
```

После чего в папке `patch/Locres` будет создан файл `OriginalGame.locres.new`, нужно перенести его с заменой по пути
`ZhuxianClient/Content/Localization/Game/zh-Hans`.

Если csv файл вы не трогали, то и Game.locres обновлять не нужно.

### Запаковка в pak

Для этого вам понадобится бесплатная утилита [repak](https://github.com/trumank/repak).
<br>После того как скачаете программу, запустите терминал из ее папки.

Команда для запаковки:
```bash
.\repak pack "D:\{путь до этого проекта}\patch\Ru_Patch_Strings_Main_P"
```

После запуска команды у вас в проекте обновится `Ru_Patch_Strings_Main_P.pak`.
<br>Можете положить его в папку с игрой, как обычно (в папку Paks в клиенте игры), 
и сами проверить свои изменения.

\* буду благодарен, если в свой Pull Request вы сразу положите обновленный пак 
и этого не придется делать мне (позже постараюсь прикрутить автоматическую сборку релиза)

## Как распаковать пак из игры

### Зачем нужно

Распаковка паков может быть нам полезна, если в игре появятся новые переводы (например, вышло обновление).
Наши файлы переводов необходимо актуализировать новыми ключами, иначе в игре не будет части текста,
так как игра не сможет найти значение по ключу.

### Распаковка

В игре паки находятся по пути `D:\{путь до игры}\ZXSJ\Game\ZhuxianClient\Content\Paks`.
<br>На данный момент (10.05.2025) текста на перевод есть только в двух паках:
1. ClientGameData.pak <-- почти все здесь
2. ClientGameData_0_P.pak
3. pakchunk0-Windows.pak - Game.locres

Для распаковки понадобится бесплатный инструмент [QuickBMS](https://aluigi.altervista.org/quickbms.htm).
<br>Для него нужен правильный bms скрипт - [unreal_tournament_4_0.4.27e_zhuxian_world_ue5.bms](unreal_tournament_4_0.4.27e_zhuxian_world_ue5.bms). 
<br>Скачайте его и положите в папку с программой QuickBMS.

Пример вызова QuickBMS для распаковаки ClientGameData.pak:
```bash
.\quickbms_4gb_files unreal_tournament_4_0.4.27e_zhuxian_world_ue5.bms "D:\{путь до игры}\ZXSJ\Game\ZhuxianClient\Content\Paks\ClientGameData.pak" "D:\{куда распаковать}\ClientGameData"
```

Паки игры зашифрованы ключом (скрипт его спросит): 
```
0xD7D19A4349AAA02C53CD9282D0E3B5B8BEE592829DD2DF729EBD0D377E4CC47D
```

После чего ждем, пока QuickBMS сделает свою работу.

\* bms скрипт и ключ шифрования игры брались [отсюда](https://cs.rin.ru/forum/viewtopic.php?f=10&t=100672), если они больше не подходят можно покопаться в этом треде

### Где искать данные

Файлы переводов лежат по тому же пути как и в данном репозитории, то есть `ZhuxianClient/.../FormatString`.
